{% extends "layout.html" %}

{% block title %}
    Register
{% endblock %}

{% block main %}
<h1 class="center title" style="margin-top: 5%; margin-bottom: 5%;">Register</h1>

<form>
  <div class="form-group row">
    <label for="username" class="col-sm-2 col-form-label">Username</label>
    <div class="col-sm-10">
      <input type="text" id="username" class="form-control" placeholder="Type your desired username here">
    </div>
  </div>

  <div id="alert-username" class="invalid-feedback" style="display:none;">Username already taken!</div>

  <div class="form-group row">
    <label for="inputpassword" class="col-sm-2 col-form-label">Password</label>
    <div class="col-sm-10">
      <input type="password" id="inputpassword" class="form-control" placeholder="Choose a password">
    </div>
  </div>
  <div id="alert-password" class="invalid-feedback" style="display:none;">
    Your password must be 6-20 characters long and must not contain spaces or special characters.
  </div>

<div class="form-group row">
    <label for="confirmpassword" class="col-sm-2 col-form-label">Confirm password</label>
    <div class="col-sm-10">
      <input type="password" id="confirmpassword" class="form-control" placeholder="Retype the above password">
    </div>
  </div>

  <button type="submit" class="btn btn-lg">Register</button>
</form>

<script>
    document.getElementById("my_form").addEventListener("submit", function(event)
    {
        event.preventDefault();
    });

    function user_check()
    {
        var my_form = document.querySelector("form");
        var username = document.querySelector("input[name='username']");
        var password = document.querySelector("input[name='password]");

        $.get("/check_username?username=" + username.value, function(available) {
            var availability = $.parseJSON(available);
            if (availability == false) {
                document.getElementById("alert-username").style.display = "block";
                document.getElementById("username").className = "form-control is-invalid";
                my_form.reset();
            }
        });
        $.get("/check_password?password=" + password.value, function(correct) {
            var correctness = $.parseJSON(correct);
            if (correctness == false) {
                document.getElementById("alert-password").style.display = "block";
                document.getElementById("username").className = "form-control is-invalid";
                my_form.reset();
            }
        });
        my_form.submit();
    }
    </script>
{% endblock %}